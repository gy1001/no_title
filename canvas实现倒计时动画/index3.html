<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<canvas id="myCanvas" width="1024" height="800"></canvas>
</body>
<script type="text/javascript" src="js/digit.js"></script>
<script type="text/javascript">
  (function () {
    var WINDOW_WIDTH = 1024;
    var WINDOW_HEIGHT = 768;
    var RADIUS = 5;
    var MARGIN_TOP = 60;
    var MARGIN_LEFT = 30,curShowTimeSeconds;

    //　最大能超过4天96小时,5天就超过三位数了
    var endTime = new Date(2017,7,25,18,47,52);
    window.onload = function () {
      var myCanvas = document.getElementById('myCanvas');
      var myContext = myCanvas.getContext('2d');
      myCanvas.width = WINDOW_WIDTH;
      myCanvas.height = WINDOW_HEIGHT;
      curShowTimeSeconds =  getCurrentShowTimeSeconds();
      render(myContext);
      setInterval(function () {
        render(myContext);
        update();
      },50)
    };

    function update() {
      var nextShowTimeSeconds = getCurrentShowTimeSeconds();
      var nextHours = parseInt(nextShowTimeSeconds / 3600);
      var nextMinute = parseInt((nextShowTimeSeconds - nextHours*3600) / 60 );
      var nextSecond = parseInt(nextShowTimeSeconds % 60);

      var curHour = parseInt(curShowTimeSeconds / 3600);
      var curMinute = parseInt((curShowTimeSeconds - curHour * 3600) / 60);
      var curSecond = parseInt(curShowTimeSeconds  % 60);

      if(nextSecond !== curSecond){
        curShowTimeSeconds = nextShowTimeSeconds;
      }

    }
    function getCurrentShowTimeSeconds() {
      var currentTime = new Date();
      var ret = endTime.getTime() - currentTime.getTime();
      ret = Math.round(ret/1000);
      return ret>=0 ?ret: 0;
    }
    function render(ctx) {
      //　每次渲染图像时候都要清除以前的数据
      ctx.clearRect(0,0,WINDOW_WIDTH,WINDOW_HEIGHT);
      var hour = parseInt(curShowTimeSeconds / 3600);
      var minute = parseInt((curShowTimeSeconds - hour * 3600) / 60);
      var second = parseInt(curShowTimeSeconds  % 60);
      renderDigit(MARGIN_LEFT, MARGIN_TOP, parseInt(hour / 10), ctx);
      renderDigit(MARGIN_LEFT + 14*(RADIUS+1)+  RADIUS+1, MARGIN_TOP , parseInt(hour % 10), ctx);
      renderDigit(MARGIN_LEFT + 28*(RADIUS+1)+2*RADIUS+1, MARGIN_TOP , 10, ctx);
      renderDigit(MARGIN_LEFT + 36*(RADIUS+1)+3*RADIUS+1, MARGIN_TOP , parseInt(minute/10), ctx);
      renderDigit(MARGIN_LEFT + 50*(RADIUS+1)+4*RADIUS+1, MARGIN_TOP , parseInt(minute%10), ctx);
      renderDigit(MARGIN_LEFT + 64*(RADIUS+1)+5*RADIUS+1, MARGIN_TOP , 10, ctx);
      renderDigit(MARGIN_LEFT + 72*(RADIUS+1)+6*RADIUS+1, MARGIN_TOP , parseInt(second/10), ctx);
      renderDigit(MARGIN_LEFT + 86*(RADIUS+1)+7*RADIUS+1, MARGIN_TOP , parseInt(second%10), ctx);
    }

    function renderDigit(x, y, num, ctx) {
      ctx.fillStyle = 'rgb(0,102,153)';
      for (var i = 0; i < digit[num].length; i++) {
        for (var j = 0; j < digit[num][i].length; j++) {
          if(Number(digit[num][i][j]) === 1){
            ctx.beginPath();
            ctx.arc(x+j*(2*RADIUS+1)+RADIUS+1, y +i*2*(RADIUS+1)+RADIUS+1,RADIUS,0,2*Math.PI );
            ctx.closePath();

            ctx.fill();
          }
        }
      }
    }
  })()
</script>
</html>